# C++ 协同编程平台 - 功能清单

## 已实现功能 ✅

### 1. 聊天系统增强
- ✅ 不同用户显示不同颜色（20种颜色自动分配）
- ✅ 消息布局优化（自己右侧，他人左侧）
- ✅ 表情选择器（56个常用表情）
- ✅ 图片上传分享
- ✅ 文件上传分享（最大50MB）
- ✅ 支持 Shift+Enter 换行

### 2. 代码管理
- ✅ 实时协同编辑
- ✅ 代码下载功能（.cpp文件）
- ✅ Monaco编辑器集成

### 3. 编译运行
- ✅ C++17 编译支持
- ✅ 标准输入支持
- ✅ 编译日志显示
- ✅ 运行结果输出
- ✅ **编译记录** - 显示谁执行了编译，保留最近10条记录
- ✅ **所有用户看到统一的编译结果**

### 4. 实时同步系统 🆕
- ✅ **输入区实时同步** - 所有用户看到相同的输入
- ✅ **输出区实时同步** - 所有用户看到相同的输出
- ✅ **编译日志实时同步** - 所有用户看到相同的日志
- ✅ **标准答案实时同步** - 所有用户看到相同的标答

### 5. 在线判题功能 🆕
- ✅ **标准答案区** - 输入或上传标准答案（支持.txt文件）
- ✅ **输入文件上传** - 上传.txt文件作为程序输入
- ✅ **输出对比功能** - 逐行对比实际输出和标准答案
  - 显示不同行的详细信息
  - 高亮显示期望值和实际值
  - 显示匹配结果统计

### 6. 用户系统
- ✅ 简单认证系统
- ✅ 会话管理
- ✅ 在线用户列表

## 待实现功能 📋

### 中优先级
- [ ] 消息引用回复
- [ ] 100个用户账号支持
- [ ] Admin用户管理界面
- [ ] 用户权限控制
- [ ] 编译记录查看界面

### 低优先级
- [ ] 代码历史版本
- [ ] 代码模板库
- [ ] 多语言支持（不仅C++）
- [ ] 性能优化
- [ ] 测试用例批量运行

## 技术栈

### 后端
- Go 1.21
- Gorilla WebSocket
- 文件存储（用户/会话）

### 前端
- Vue 3
- Element Plus
- Monaco Editor
- Vite

## API 接口

### 已实现
- `POST /api/login` - 用户登录
- `POST /api/logout` - 用户登出
- `POST /api/upload` - 文件上传
- `GET /api/download/code` - 代码下载
- `GET /uploads/:filename` - 文件下载
- `WS /ws` - WebSocket连接

### 计划中
- `GET /api/users` - 获取用户列表（Admin）
- `POST /api/users` - 创建用户（Admin）
- `DELETE /api/users/:id` - 删除用户（Admin）
- `GET /api/compile/history` - 编译历史

## 文件结构

```
cocode/
├── backend/
│   ├── config/          # 配置管理
│   ├── handlers/        # HTTP/WebSocket处理器
│   │   ├── auth.go
│   │   ├── websocket.go
│   │   ├── upload.go   # 文件上传
│   │   └── code.go     # 代码下载
│   ├── models/          # 数据模型
│   ├── services/        # 业务逻辑
│   └── main.go
├── frontend/
│   └── src/
│       ├── components/
│       │   ├── ChatPanel.vue    # 聊天组件
│       │   └── CodeEditor.vue   # 编辑器组件
│       └── App.vue
├── data/
│   ├── users.txt        # 用户数据
│   ├── uploads/         # 上传文件
│   └── temp/            # 临时编译文件
└── config.toml          # 主配置
```

## 数据存储

### 用户数据 (data/users.txt)
```
username:password:displayname
admin:admin123:管理员
userA:passwordA:用户A
```

### 上传文件 (data/uploads/)
- 自动生成唯一文件名
- 防止路径遍历攻击
- 50MB大小限制

## 安全注意事项

⚠️ **当前版本为演示项目，生产环境需要改进：**
- 密码采用明文存储（需要bcrypt哈希）
- 代码执行无沙箱隔离（建议Docker容器）
- WebSocket无速率限制
- 未实现HTTPS
- 需要加强输入验证

## 更新日志

### 2024-11-20 v2.0 - 在线判题功能 🎉
**重大更新：实现所有高优先级功能**

#### 实时同步系统
- 输入区、输出区、编译日志区所有用户实时同步
- 标准答案区实时同步
- 任何用户的修改其他用户立即可见

#### 在线判题功能
- 新增标准答案区域（支持手动输入和文件上传）
- 输入区支持文件上传（.txt格式）
- 输出对比功能：逐行对比实际输出和标准答案
  - 高亮显示不同的行
  - 显示期望值和实际值
  - 显示匹配结果统计

#### 编译记录系统
- 记录谁执行了编译操作
- 显示编译者用户名
- 所有用户收到编译通知
- 保留最近10条编译记录

#### 其他改进
- 优化WebSocket消息处理
- 改进UI布局，添加对比结果展示
- 增强文件上传功能

### 2024-11-20 v1.1 - 聊天增强
- 添加聊天多媒体功能（表情、图片、文件）
- 实现代码下载功能
- 优化聊天UI（颜色区分、左右布局）
- 添加文件上传系统（50MB限制）

### 2024-11-18 v1.0
- 初始版本发布
- 实现基础协同编辑功能
- 实现C++编译运行
- 实现简单聊天系统
